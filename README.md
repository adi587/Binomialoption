# Binomialoption
I was reading through the mathematics of bionmial tree pricing for options and thought it would be interesting to try implement it into a python script. The binomial trees model allows us to value both American and European options whilst the Black scholes equation can only value European options. 

# Overview of mathematics of option pricing
Here is a brief overview of the mathematics behind the tree valuation (for an indepth explanation look at J.Hull: Options, Futures and Other Derivatives):
Initially assume stocks is at price $S_0$ and can increase to $S_0 u$ ($u>1$) or decrease to $S_0 d$ ($d<1$) after a time step (denoted as $T$). Consider an option with current price $f$ with this stock as the underlying. The price of the option when the stock increases in value is $f_u$ and $f_d$ when it decreases. We can create a risk free portfolio by selling one option at price $f$ and buying $\Delta$ (to be determined) of the underlying stock. This gives a total portfolio value of $S_0\Delta-f$. To make it risk free the value of the portfolio must be same regardless of an upturn or downturn of the stock. This gives the following equality $S_0u\Delta -f_u=S_0d\Delta-f_d$. This means $\Delta=\frac{f_u-f_d}{S_0u-S_0d}$. So to make a riskless portfolio we need to go long this $\Delta$ amount of underlying stock and short one option contract. This means the price of the portfolio increases with the risk free rate (Else risk free arbitrage would be possible). This means $(S_0-f)e^{rT}=(S_0u\Delta-f_u)$. Subsituting $\Delta$ and rearranging we get $f=e^{-rT}(pf_u+(1-p)f_d)$ where $p=\frac{e^{rT}-d}{u-d}$. $p$ can be understood as the probability of the stock going up (in a risk neutral world). This can be extended for to multiple step trees (look at J.Hull book for the steps). The nodes at termination are valued first. Then using the equation we have derived for a one step tree we can find the option price for the previous node. This continous until we arrive back to the starting node (present time) giving $f$. To improve accuracy more steps/nodes are added to the tree making $T$ smaller for a fixed expiry date. American options can be evaulated through this method by determining whether it is optimal to execute the option early or not at each node. The max between the payoff from executing the option at this node or the value of option using the above pricing formula gives the option value at that node. Stock that pay continous dividends $q$ is added in by setting $p=\frac{e^{(r-q)T}-d}{u-d}$ (J.Hull book explains this in more detail). 

Now need to match $u,d$ with real annualised volatiltiy ($\sigma$). By definition of volatility: $\sigma^2 \delta t= E(X^2)-(E(X))^2)$, where $\delta t$ refers to some short time period and variable $X$ is return of stock. This equation says the variance of the return of a stock over $\delta t$ is $\sigma^2\delta t$. Note $X=(d-1)$ with probability $1-p$ or $u-1$ with probability $p$. With some subsitutions, re arrangements and assumptions in $\delta t$ (ignoring terms $\delta t^2$ and higher) we get $u=e^{\sigma\sqrt{\delta t}}$ and $d=e^{-\sigma\sqrt{\delta t}}$. Therefore given volatility we can define $u$ and $d$ and therefore build the binomial tree. This is done in file Binomomialoption.py. 

A possible extension of this model would be to add in dividend dates rather than annual dividends. Using this binomial tree model we can incorporate the drop in underlying asset price when a payment is given. This would be done when the underlying asset price tree cross the dividend payment date. All the nodes at this point will decrease by the dividend payment value, the tree would continue as normal from thereafter. The option tree will then be valued ontop of this new underlying tree.

# Calculating Greeks
After setting up the valuation tree I next wanted to calculate various greeks using the binomial tree. The partial derivatives of the Black-Scholes equation gives the various greeks analytically (for European options). This cannot be done with the binomial tree model, a discrete 'approximation' method must be used. This method will allow us to calculate the greeks for both American and European options. For theta, vega and rho we first rerun the tree with the same parameters but deviate the required paramters by $0.1\%$ (E.g. when calculating vega we rerun the underlying tree with $\sigma*1.001$). Then calculate the difference between this price and the original price and divide this by the difference in the parameter. For example $vega=\frac{OptPrice(1.001\sigma)-OptPrice(\sigma)}{0.001\sigma}$.

For delta and gamma the original tree can be used. The trees starting node has 3 states added to it, with underlying prices of $S_0 u,S_0,S_0 d$. This way we can already the nodes created in the initial pricing tree and just need to add 2 extra branches (implicitly assuming the addition of the 2 branches will not affect the $S_0$ price much) and find what the new nodes are at starting time. This can then be used to work out delta and gamma (shown in code).

# Implied volatility calculation
After calculating greeks I created an implied volatility calculator to use for implied volatility surface project. To do this I used the bisection numerical method (as option price monotonically increases with volatility) with the binomial option trees. I added a black scholes calculator to this to allow quicker calculations for european options.
   
